<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'BODCAST</title>
    <link rel="shortcut icon" href="https://i.ibb.co/TDBpFZ8P/favicon.png" type="image/x-icon">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap');

        * {
            font-family: "Poppins", sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: black;
            display: flex;
            flex-direction: column;
           
            height: 100vh;
          
        }

        nav {
            width: 100%;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            width: 150px;
        }

        #profilePic {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
        }

        #bottomDiv {
            padding: 20px;
            width: 100%;
            color: black;
            background-color: white;
            height: 400px;
            position: fixed;
            bottom: -400px;  /* Initially hidden */
            left: 0;
            border-radius: 20px 20px 0 0;
            transition: bottom 0.3s ease-in-out;
        }

        /* Show class to make it slide up */
        #bottomDiv.show {
            bottom: 0;
        }
        .categories-section , .TrendingPodcasts-section{
            gap: 10px;
           margin: 20px 0 ;
        }
        .sectionTitle{
            color: white;
            padding: 0 10px ; 
            font-size: 20px;
            font-weight: 600;
        }
        #categories{
            margin-top: 15px;
            gap: 10px;
            padding: 0 10px;
            overflow-x: scroll;
            scrollbar-width: none;
            display: flex;
        }
        .categorieLabel{
        
        color: white;
        border: solid 2px white;
        padding: 4px;
        border-radius: 10px;
        transition: all .3s ease-in-out;
    
    }

    .chosenCategorie.categorieLabel{
        color: black;
        border: solid 2px white;
    
        background-color: white;
        padding: 4px;
        border-radius: 10px;
        transition: all .3s ease-in-out;
    }

    #TrendingPodcasts{
        padding: 10px;
        display: flex;
        gap: 10px;
        overflow-x: scroll;
        scrollbar-width: none;
    }
    .podcastCard {
        border: solid 2px transparent;

        border-radius: 10px;
        width: 250px;
        height: 250px;
        transition:  all .3s ease-in-out;
        
    
    }
    .podcastCard:hover{
        border: solid 2px white;

        box-shadow: 1px -1px 10px 2px white;
        transition:  all .3s ease-in-out;

    }


    #TopCreators{
        display: flex;
        gap: 10px;
        padding: 10px;
        overflow-x: scroll;
        scrollbar-width: none;
    }
    .creatorCard{
        border: solid 2px transparent;
        width: 100px;
        height: 100px;
        transition: all .3s ease-in-out;
        border-radius: 18px;

    }
    .creatorCard:hover{
        border: solid 2px white;
        transition: all .3s ease-in-out;
        box-shadow: 1px -1px 10px 2px white;


    }
    </style>
    
</head>
<body>

    <nav>
        <img class="logo" src="https://i.ibb.co/rTWndbQ/logo.png" alt="L'BODCAST">
        <img id="profilePic" src="https://letter-image-generator.vercel.app/generate_image?firstname='&lastname=b" alt="">
    </nav>

    <div id="bottomDiv">
        <p id="name-b"><strong>Name:</strong> John</p>
        <p id="email-b"><strong>Email:</strong> john@gmail.com</p>
    <button id="logout">log-out</button>
 </div>
        
 <div class="categories-section">
    <label class="sectionTitle">Categories</label>
   <div id="categories">

   </div>
</div>




<div class="TrendingPodcasts-section">
    <label class="sectionTitle">Trending podcasts</label>
   <div id="TrendingPodcasts">

   </div>
</div>


<div class="Topcreators-section">
    <label class="sectionTitle">Top creators</label>
   <div id="TopCreators">

   </div>
</div>



    <script>
        const bottomDiv = document.getElementById('bottomDiv');
        const profilePic = document.getElementById('profilePic');
        const categories =document.getElementById('categories')

        if (bottomDiv && profilePic) {
            profilePic.addEventListener('click', () => {
                bottomDiv.classList.toggle('show');
            });
        }

 const podcastCategories = [
    "all" , 
  "News",
  "Politics",
  "Technology",
  "Science",
  "Education",
  "Business",
  "Finance",
  "Crime",
  "Health",
  "Wellness",
  "Comedy",
  "Sports",
  "Entertainment",
  "Culture",
  "SelfImprovement",
  "Fiction",
  "Philosophy",
  "Spirituality"
];

for (const categorieName of podcastCategories) {
    const label = document.createElement("label");
    label.innerHTML = categorieName;
    label.id = categorieName;
    label.className = categorieName == 'all' ?  "categorieLabel chosenCategorie" : "categorieLabel" ;


    label.addEventListener("click", (event) => {
        document.querySelectorAll(".categorieLabel").forEach((el) => {
            el.classList.remove("chosenCategorie");
        });
        event.target.classList.toggle("chosenCategorie");
    });

    categories.append(label);
}



/*const podcastsMap = {
    "podcat_id_1" : {
        "cover" : "https://i.ibb.co/NBYWskR/1.png"
    },
    "podcat_id_2" : {
        "cover" : "https://i.ibb.co/NBYWskR/1.png"
    },
    "podcat_id_3" : {
        "cover" : "https://i.ibb.co/NBYWskR/1.png"
    },
}
*/
function displayPodcasts(podcastsMap){
   const trendingPodcasts = document.getElementById('TrendingPodcasts')
for(const podcastId in podcastsMap){
    const podcastCover = podcastsMap[podcastId].cover
    const podcastCard = document.createElement('img')
    podcastCard.src = podcastCover
    podcastCard.id = podcastId 
    podcastCard.className = "podcastCard"
    podcastCard.addEventListener('click' , 
        () => {console.log(podcastId)}
    )
    trendingPodcasts.append(podcastCard)
    
}
 
}
//displayPodcasts(podcastsMap)


/*const creatorsMap = {

    "creator_id_1" : {
        "avatar" : "https://i.ibb.co/4wkTPcn9/icon-2.png"
    },
    "creator_id_2" : {
        "avatar" : "https://i.ibb.co/4wkTPcn9/icon-2.png"
    },
    "creator_id_3" : {
        "avatar" : "https://i.ibb.co/4wkTPcn9/icon-2.png"
    },
    "creator_id_4" : {
        "avatar" : "https://i.ibb.co/4wkTPcn9/icon-2.png"
    },
    "creator_id_5" : {
        "avatar" : "https://i.ibb.co/4wkTPcn9/icon-2.png"
    },
 
}*/

function displayCreators(creatorsMap){
const topCreators =  document.getElementById('TopCreators')

for(const creator_id in creatorsMap){
    const creatorAvatar = creatorsMap[creator_id].avatar 
    const creatorCard = document.createElement('img') ; 
    creatorCard.src = creatorAvatar 
    creatorCard.id = creator_id 
    creatorCard.className = 'creatorCard'
    creatorCard.addEventListener('click' , () => {console.log(creator_id) ; })
    topCreators.append(creatorCard)


}

}

//displayCreators(creatorsMap)




    </script>



<script type="module">
     
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDFmufOx1aX_JMJsfeXMIzD0nGqQ1pSZIA",
        authDomain: "l-bodcast.firebaseapp.com",
        projectId: "l-bodcast",
        databaseURL: "https://l-bodcast-default-rtdb.firebaseio.com/",
        storageBucket: "l-bodcast.appspot.com",
        messagingSenderId: "1007184602665",
        appId: "1:1007184602665:web:dae80c9b3f208f5749de38",
        measurementId: "G-BX9F49FM08"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app); // ✅ Fix: Pass app to ensure correct initialization

    // Retrieve user data from local storage (if needed)
    const userdata = localStorage.getItem('userCredential');
    console.log("User Credential Data:", userdata);

    // Get reference to HTML container
    const container = document.getElementById('container');

    // Listen for authentication state changes
    onAuthStateChanged(auth, async (user) => { // ✅ Fix: Correct syntax, first argument is `auth`
        if (user) {
            console.log("User is logged in:", user.email);

            try {
              //  const usernamesnapshot = await get(ref(db, `users/${user.uid}/profilePic`));

                // ✅ Fetch user profile picture from Firebase Database
                const snapshot = await get(ref(db, `users/${user.uid}`));
                const profilePicsrc = snapshot.exists() ? snapshot.val().profilePic : "default-profile.png"; // Use default if not found
                const displayName = snapshot.exists() ? snapshot.val().firstName : "default-profile.png"; // Use default if not found
             

                profilePic.src = profilePicsrc
                document.getElementById('name-b').innerHTML = `<strong>Name:</strong> ${displayName}`
                document.getElementById('email-b').innerHTML = `<strong>Email:</strong> ${user.email}`
              
            } catch (error) {
                console.error("Error fetching profile picture:", error.message);
            }
        } else {
            console.log("User is not logged in , redirecting...");
            window.location.href = 'welcom.html'; 
        }
    });




    const podcastsMap = await get(ref(db, `podcasts`));
    const creatorsMap = await get(ref(db, `creators`));

    displayPodcasts(podcastsMap.val())

    displayCreators(creatorsMap.val())






    // Function to log out user
    function logout() {
        signOut(auth) // 
            .then(() => {
                console.log("User logged out");
                window.location.href = "loginMethod.html"; // Redirect to login page
            })
            .catch(error => {
                alert("Error logging out: " + error.message);
            });
    }

    // Attach event listener to logout button
    document.getElementById('logout').addEventListener('click', () => {
        logout();
    });

</script>



</body>
</html>